@page
@model Web.Pages.Product.IndexModel
@{
    ViewData["Title"] = Model.ProductModel.ProductTitle;
}

<div class="row mt-md-5">
    <div class="col-md-6">
        <div class="row align-items-center">
            <div class="dama-product-thumbnails col-3 text-center">
                <a href="#" class="top-arrow"><i class="fas fa-chevron-up"></i></a>
                <div class="slider-nav">
                    @foreach (var item in Model.ProductModel.ProductImagesUri)
                    {
                        <div><img src="@item" class="img-thumbnail" alt="Imagem do Produto" /></div>
                    }
                </div>
                <a href="#" class="bottom-arrow"><i class="fas fa-chevron-down"></i></a>
            </div>
            <div class="col-12 col-md-9 text-center">
                <div class="dama-product-title-mobile pt-1 pb-1">@Model.ProductModel.ProductTitle</div>
                <div class="slider-for">
                    @foreach (var item in Model.ProductModel.ProductImagesUri)
                    {
                        <div><img src="@item" class="img-fluid" alt="Imagem do Produto" /></div>
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        @Html.Partial("_productDetail", Model.ProductModel)
    </div>
</div>
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        $(document).ready(function () {
            $('.slider-nav').slick({
                slidesToShow: 3,
                slidesToScroll: 1,
                arrows: true,
                vertical: true,
                prevArrow: $('.top-arrow'),
                nextArrow: $('.bottom-arrow'),
                focusOnSelect: true,
                asNavFor: '.slider-for'
            });

            $('.slider-for').slick({
                slidesToShow: 1,
                slidesToScroll: 1,
                arrows: false,
                fade: true,
                asNavFor: '.slider-nav',
                responsive: [
                    {
                        breakpoint: 992,
                        settings: {
                            infinite: true,
                            arrows: true,
                            centerMode: true,
                        }
                    }]
            });
            $('.dama-product-description').on('click touch', function () {
                if ($(this).css('white-space') == 'normal') {
                    $(this).css('white-space', 'nowrap');
                    $(this).css('text-overflow', 'ellipsis');
                }
                else if ($(this).css('white-space') == 'nowrap') {
                    $(this).css('white-space', 'normal');
                    $(this).css('text-overflow', 'initial');
                }
            });
            $('#btnAdd').on('click', function () {
                var value = $('#ProductQuantity').val();
                if (value)
                    $('#ProductQuantity').val(parseInt(value) + 1);
                else
                    $('#ProductQuantity').val(1);
            });
            $('#btnSub').on('click', function () {
                var value = $('#ProductQuantity').val();
                if (value && parseInt(value) > 1)
                    $('#ProductQuantity').val(parseInt(value) - 1);
                else
                    $('#ProductQuantity').val(1);
            });
            $('.atribute-items').on('change', function () {
                var attr = $(this).val();
                var productBase = parseFloat('@Model.ProductModel.ProductBasePrice'.replace(',', '.'));
                $('.dama-product-price span').text(toNumber(productBase));
                var newprice = productBase;
                $('.atribute-items').each(function () {
                    var attrValue = $(this).val();
                    if (attrValue != -1) {
                        var handlerUrl = '@Url.Page("/Product/Index", "attributedetails", new { id = "ATTRVALUE" })';
                        handlerUrl = handlerUrl.replace('ATTRVALUE', attrValue);
                        $.getJSON(handlerUrl)
                            .done(function (data) {
                                if (attr == attrValue && data.sku) {
                                    //Redirect
                                    var url = '@Url.Page("/Product/Index", new { id = "SKU" })';
                                    url = url.replace('SKU', data.sku);
                                    window.location.href = url;
                                }
                                if (data.price) {
                                    newprice += parseFloat(data.price);                                    
                                    $('.dama-product-price span').text(toNumber(newprice));
                                }
                            })
                            .fail(function (jqxhr, textStatus, error) {
                                var err = textStatus + ", " + error;
                                console.log("Request Failed: " + err);
                            });
                    }
                    

                });                
            });
        });
    </script>
}